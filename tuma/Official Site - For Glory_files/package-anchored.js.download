sndefine("visibility",["browser","global"],function(e,t){var i=this;function n(t){if(t||(t={}),this.onStateChanged=t.onStateChanged)if(this.context=t.context||this,e.has.touch){var n=!1;i.addEventListener("pageshow",function(){n?this.signalVisibilityChange(!1):n=!0}.bind(this)),i.addEventListener("pagehide",this.signalVisibilityChange.bind(this,!0))}else i.document.addEventListener("visibilitychange",function(){this.signalVisibilityChange(i.document.hidden)}.bind(this))}return n.prototype.signalVisibilityChange=function(e){e?this.onStateChanged.call(this.context,"suspend"):t.setTimeout(this.onStateChanged.bind(this.context,"restore"),100)},n}),sndefine("spacer",["browser","utils","css","core-sleeknote","behaviour","custom-elements","location"],function(e,t,i,n,o,s,r){var a=this,c=a.document,l={},h={};const f=!n.editor;function g(e){this.note=e,this.config=o.defaults("spacer",e.config),this.dimensions=function(){return{width:this.note.dims.width,height:this.note.dims.bounds.height}}}function d(){this.reset()}let u;async function m(e){var n=e.config;let r="sleeknote-spacer";return n.DOMNode||(u||(u=s({name:r,style:i.inline(t.extend({},o.custom.anchored.host,{flexShrink:0,flexGrow:0},n.style)),after:function(){return t.qsa(n.selector,c)[0].insertAdjacentElement(n.insert,c.createElement(r))},shadowDOM:f})),n.DOMNode=await u,p.call(this,e)),n.DOMNode}function p(e){var i=e.config,o=t.qsa(i.selector)[0];if("bodyTop"!=i.def)return;null==i.height&&(i.height=e.dimensions().height);let s=parseFloat(a.getComputedStyle(e.note.config.DOMNode).height);s!=i.height&&(e.note.dims.bounds.height=i.height=s);var l,h=n.custom("sleekbarForcePush"),f=[];if(h){"string"!=typeof h&&(h="nav, header, #header, body > .section-header, body > *:not(span, script, iframe, anchor)"),g(),this.destroy=function(){delete this.destroy,this.destroy.apply(this,arguments),clearInterval(l),d(0,!1),a.removeEventListener("scroll",u,{passive:!0});try{this.resizeObserver.disconnect()}catch(e){}delete this.resizeObserver};try{this.resizeObserver=new a.ResizeObserver(t=>{t.forEach(t=>{var n=t.contentRect.height;e.config.DOMNode.style.height=n+"px",d(i.height=n)})}),this.resizeObserver.observe(e.note.config.DOMNode)}catch(e){}if(d(i.height),f.length&&(a.addEventListener("scroll",u,{passive:!0}),e.note.campaign.config.options.some(({id:e})=>"onepagesite"==e))){let e=String(r.get(n));l=setInterval(()=>{e!==(e=String(r.get(n)))&&(g(),u())},1e3)}}function g(){f=t.qsa(h,o).filter(function(e){return(0!=e.clientHeight||0!=e.clientWidth)&&"hidden"!=a.getComputedStyle(e).visibility})}function d(t,n){f.forEach(function(o){let{position:s}=a.getComputedStyle(o);if(!["fixed","sticky","absolute"].includes(s))return;null==o._offsetTop&&(o._offsetTop="absolute"==s?o.offsetTop:o.offsetTop-a.scrollY);let r=o._offsetTop+Math.max(0,t-a.scrollY);"fixed"==s&&0!=n&&(r=Math.max(i.height,r)),"sticky"==s&&0!=n&&e.note.config.DOMNode.parentNode!=c.body&&(e.note.config.DOMNode.style.marginTop=-a.scrollY+"px"),n&&n(o)||(r?o.style.setProperty("top",`${r}px`,"important"):o.style.removeProperty("top"))})}function u(){d(i.height)}}return d.prototype={reset:function(){return h={},this},set:function(e){var t=new g(e);return"close"==t.config.next&&h[t.config.id]||(h[t.config.id]=t),this},execute:function(e){var t;for(t in l)l.hasOwnProperty(t)&&(h[t]?(this.create(h[t]),delete h[t]):e||this.destroy(l[t]));for(t in h)h.hasOwnProperty(t)&&(this.create(h[t]),delete h[t]);return this},reposition:function(){var e,n;for(e in l)l.hasOwnProperty(e)&&((n=l[e]).config=t.extend(n.config,o.defaults("spacer",n.note.config)),i.set(n.config.DOMNode,{height:n.dimensions().height}))},css:function(e,n){i.set(e.config.DOMNode,t.extend({},n.to.animate,e.config.style))},create:async function(e){var t=e.config.id;if(l[t]){var n=l[t].config.DOMNode;l[t]=e,l[t].config.DOMNode=n}else await m.call(this,e),l[t]=e,i.reveal(l[t].config.DOMNode);var s=o.animationParameters(l[t],"close","open",l[t].note);"sleeknote-spacer-body"==t&&0==s.to.animate.height&&delete s.to.animate.height,this.css(l[t],s)},destroy:function(e){var i=e.config.id;if(l[i]){var n=o.animationParameters(l[i],"open","close",l[i].note);"shared"==l[i].config.kind?this.css(l[i],n):(t.removeNode(l[i].config.DOMNode),delete l[i])}}},d}),sndefine("cover-screen",["browser","utils","css","animation-utils","core-sleeknote","behaviour","anchors","custom-elements"],function(e,t,i,n,o,s,r,a){function c(){this.config=s.defaults("cover",{})}const l=!o.editor;return c.prototype={dimensions:function(){return this.config.width=o.editor?"100%":"101vw",this.config.height=o.editor?"100%":"101vh",this.config},insert:async function(){let e=await r.top,n="sleeknote-cover-box",c=`<div style="height:100%; width:100%" onclick="void(0)" id=${n}></div>`;o.editor&&(c=`<div style="height:100%; width:100%; pointer-events:auto!important" id=${n}></div>`),this.config.DOMNode=await a({name:"sleeknote-cover",html:c,style:i.inline(t.extend({},s.custom.anchored.host,{width:"100%"})),target:l?e.shadowRoot:e,shadowDOM:l});let h=this.config.DOMNode;this.config.boxNode=(l?h.shadowRoot:h).querySelector(`#${n}`)},remove:function(){this.config.DOMNode&&(this.removeListener(),t.removeNode(this.config.DOMNode))},after:function(){this.config.DOMNode&&"close"==this.config.current&&i.conceal(this.config.DOMNode)},reposition:function(e,t){if(this.config.DOMNode){var o=s.needs.cover(e)?"open":"close";i.set(this.config.DOMNode,n.createPositionStyles(s.boxParameters(this,o),"to")),console.log("reposition cover",this.config.current,o),this.config.current=o,this.after()}},prepare:async function(e,t){var r=this.config.current;if(this.config.DOMNode&&e!=r){if(this.config.next=e,this.params=s.animationParameters(this,r,e),this.params.width,t){let e=t.config.version>4?"rgba(0,0,0,0.6)":"radial-gradient(ellipse at center, rgba(0,0,0,0.1) 40%,rgba(0,0,0,0.6) 100%)";this.config.boxNode.style.background=e}return n.createMotion(this.params,function(t,n,s){i.set(this.config.DOMNode,t),o.editor&&"close"==e&&i.set(this.config.DOMNode,{height:0}),s&&(this.config.current=this.config.next,"close"==this.config.current&&i.conceal(this.config.DOMNode))}.bind(this))}}},c}),sndefine("font-loader2",["utils","filefetcher","global","core-sleeknote"],function(e,t,i,n){const o=globalThis,s=o.document;function r(e,t){return new i.Promise(function(n,o){i.setTimeout(o.bind(0,t),e)})}function a(e){return o.getComputedStyle(e)}function c(t){let n={};function r(t){let o=e.normalizeFontFamily(t.getPropertyValue("font-family"));n[o]||(n[o]=new i.Set),n[o].add(function(e){return h.map((t,i)=>{let n=e.getPropertyValue(l[i])||"normal";return"weight"==t&&(n="bold"==n?700:"normal"==n?400:n),"variant"==t&&"normal"!=n&&"small-caps"!=n&&(n="normal"),n}).join(" ")}(t))}return function(t,i){let n=o.NodeFilter;for(var r,a=s.createTreeWalker(t,n.SHOW_TEXT,function(t){return e.contains(t.parentNode.nodeName,"STYLE","SCRIPT")?n.FILTER_SKIP:n.FILTER_ACCEPT},!1);a.nextNode();)(r=a.currentNode).data.match(/\S/)&&i(r.parentNode)}(t,function(e){r(a(e))}),e.slice(t.querySelectorAll("input")).forEach(function(e){r(a(e))}),n}let l=["font-style","font-variant","font-weight"],h=["style","variant","weight"];const f=s.fonts.ready,g={};f.then(()=>{if(s.fonts.size){let t=document.fonts.values();for(;;){let{done:n,value:o}=t.next();if(n)break;let s=e.normalizeFontFamily(o.family);s&&(g[s]||(g[s]=new i.Set),g[s].add(h.map(e=>"weight"==e&&"normal"==o[e]?400:o[e]).join(" ")))}}});let d={},u=new i.Set;function m(t){let o=function(e){let t=s.implementation.createHTMLDocument(""),i=s.createElement("style");i.textContent=e,t.body.appendChild(i);let o=n.custom("replaceOriginalFontFamilies")||{},r=i.sheet.cssRules;if(Object.keys(r).length)for(let e of r){let t=o[e.style.fontFamily];t&&(e.style.fontFamily=t)}return Array.from(r)}(t),r=[];for(let[t,i]of e.entries(o)){let n=i.style,o=e.normalizeFontFamily(n.getPropertyValue("font-family")),s=h.map((e,t)=>n.getPropertyValue(l[t])||"normal").join(" ");for(let[e,i]of Object.entries(g))if(e==o)for(let e of i)e==s&&(r.push(t),u.add(`${s} 12px/1.2 "${o}"`))}let a="";for(let[t,n]of e.entries(o))if(!r.includes(t)){let t=n.style,o=e.normalizeFontFamily(t.getPropertyValue("font-family")),s=h.map((e,i)=>t.getPropertyValue(l[i])||"normal").join(" ");d[o]||(d[o]=new i.Set),d[o].add(s),a+=n.cssText+"\n"}return a}let p=new i.Set;return function(o,a){let l=c(a);for(let[t,i]of e.entries(o))p.has(i)&&o.splice(t,1);if(o.length&&e.keys(l))return f.then(()=>i.Promise.all(o.map(function(e){return o.includes("?")&&(e+="&display=swap"),function(e){return t(e).then(function(e){return e.clone().text()},function(){return i.Promise.reject(e)})}(e)})).then(function(t){for(let[i,n]of e.entries(t)){let e=m(n),t=o[i];if(e&&!p.has(t)){p.add(t);let i=s.createElement("style");i.setAttribute("data-href",t),i.textContent=e,s.head.appendChild(i)}}let a=[];for(let[t,o]of e.entries(l))if(t in d&&d[t].size)for(let e of o){let o=`${e} 12px/1.2 "${t}"`;u.has(o)||(n.custom("skipFontLoad")||a.push(i.Promise.race([r(2e3,"timed out"),s.fonts.load(`${e} 12px/1.2 "${t}"`)])),u.add(o))}return e.allSettled(a).then(function(t){for(let n of e.values(t))if("rejected"==n.status)return i.Promise.reject(n.reason);return i.Promise.resolve("ok")})},function(e){return i.Promise.reject(e)}))}}),sndefine("orchestrator",["browser","utils","animator","core-sleeknote","visibility","spacer","behaviour","animation-utils","cover-screen","constants","click","event-emitter","global","anchors"],function(e,t,i,n,o,s,r,a,c,l,h,f,g,d){var u=this;const m=!n.editor;var p=n.editor||n.preview;const v=l.CORE.COMMANDS;function y(e,t,i,n){if(!(this instanceof y))return new y(e,t,i,n);e instanceof y?(this.campaign=e.campaign,this.command=e.command,this.noteName=e.noteName,this.callback=e.callback):(this.campaign=e,this.command=t,this.noteName=i,this.callback=n)}function b(){this.visibles={},this.queue=[],this.busy=!1,this.spacer=new s}return b.prototype={get empty(){return!Object.keys(this.visibles).length},get stopper(){for(let e in this.visibles)if(this.visibles.hasOwnProperty(e)&&this.isStopper(this.visibles[e]))return this.visibles[e]},getBoxType:function(e){return e.campaign?e.campaign.notes[e.noteName].config.type:""},isStopper:function(e){if(!e||e.campaign.isSleekBar)return!1;if(n.editor)return!0;return"concurrent"!=(l.PROFILE.MOBILE==e.campaign.config.profile?"sequential":n.custom("notemanagermode")||"concurrent")||t.contains(this.getBoxType(e),"form","success","calendar")},addToVisibles:function(e,t){var i=this.visibles[e.id];return i?i.noteName=t:i=this.visibles[e.id]=y(e,"",t),i},removeFromVisibles:function(e){if(e=this.visibles[e.campaign.id])return delete this.visibles[e.campaign.id],e},extractCloseRequest:function(){for(var e,t=this.queue.length;t--;)if(this.queue[t].command==v.CLOSE)return e=this.queue[t],this.queue.splice(t,1),e},positionIsOccupied:function(e){var t,i;for(t in this.visibles)if(this.visibles.hasOwnProperty(t)&&(i=this.visibles[t]).campaign.config.position==e.config.position)return i},extractSleekBar:function(){for(var e,t=this.queue.length;t--;)if((e=this.queue[t]).campaign.isSleekBar&&e.command!=v.CLOSE&&"form"==this.getBoxType(e)&&!this.positionIsOccupied(e.campaign))return this.queue.splice(t,1),e},triggerCommand:function(e){f(e.command,{creator:l.CORE.CREATOR.API,name:e.noteName,origin:e.campaign.notes[e.noteName],trigger:"queue"})},paused:!1,nextCalled:[],allowedCampaignId:!1,pause:function(e){this.paused||(this.paused=!0,this.allowedCampaignId=e)},resume:function(){this.allowedCampaignId=this.paused=!1,this.nextCalled.length&&(this.next(...this.nextCalled),this.nextCalled=[])},triggerCloseAction:function(e){let t=this.stopper;if(!t)return;let i=t.campaign.notes[t.noteName],n=i.doc.querySelectorAll("[data-sn-type=close], .sleeknoteMobileClose")[0];n&&i.onClick(e,n)},next:async function(e,o,s){var a,g,y;if(!this.queue.length)return 0;let b=[];for(;a=this.extractCloseRequest();)b.push(a),this.removeFromVisibles(a),s||this.triggerCommand(a);if(!n.editor)for(;a=this.extractSleekBar();)b.push(a),this.addToVisibles(a.campaign,a.noteName),this.triggerCommand(a);for(;;){if(this.queue.length){if(this.paused&&this.queue[0].campaign.id!=this.allowedCampaignId){this.nextCalled=Array.prototype.slice.call(arguments);break}if(!e&&this.stopper&&this.isStopper(this.queue[0]))break;if(!n.editor&&this.queue[0].campaign.isSleekBar&&(a=this.positionIsOccupied(this.queue[0].campaign))&&a.campaign!=this.queue[0].campaign)break;g=this.queue.shift();let i=t.contains(g.command,v.OPEN,v.REVEAL);if((a=this.visibles[g.campaign.id])&&a.noteName==g.noteName&&i)break;b.push(g),(a=this.visibles[g.campaign.id])&&i&&(a.command=v.CLOSE,y=a.noteName,b.push(a),this.removeFromVisibles(a)),this.isStopper(g)&&(a=this.stopper)&&(a.command=v.CLOSE,b.push(a),this.removeFromVisibles(a),p||this.add("unshift",a.campaign,v.OPEN,a.noteName)),this.addToVisibles(g.campaign,g.noteName),e||this.triggerCommand(g)}break}if(!b.length)return;var E,O=[];function N(){if(E)return O=O.concat(E),E=!1,!0}this.spacer.reset();var w=g&&g.campaign.notes[g.noteName];if(this.busy=!0,n.needBadge){if(!this.badge){let e=await u.arequire("badge");this.badge||(this.badge=new e,await this.badge.insert())}E=this.isStopper(g)&&r.needs.badge(w.config)?await this.badge.prepare(v.OPEN,w):await this.badge.prepare(v.CLOSE)}if(N(),w&&r.needs.cover(w.config)){if(!this.cover&&(this.cover=new c(this.viewport),await this.cover.insert(),!p&&!this.removeCoverListener)){let e=this.cover.config.DOMNode;this.removeCoverListener=h.listen((m?e.shadowRoot:e).querySelector("div"),e=>{this.triggerCloseAction(e)}),u.document.body.addEventListener("keydown",e=>{let t=this.cover.config.DOMNode;27==e.keyCode&&"visible"==t.style.visibility&&this.triggerCloseAction({})},!0)}E=await this.cover.prepare(v.OPEN,w)}else{var S=this.stopper;S&&r.needs.cover(S.campaign.notes[S.noteName].config)||this.cover&&(E=await this.cover.prepare(v.CLOSE))}N();var x,C=g&&g.noteName;for(let e of t.values(b)){let t;g&&e.campaign==g.campaign&&(t=e.noteName==g.noteName?y:C),E=await e.campaign.prepareNote(e.noteName,e.command,t),x=e.campaign.notes[e.noteName],N()&&e.command!=v.CLOSE&&r.needs.spacer(x.config)&&this.spacer.set(x)}for(let e of t.keys(this.visibles))x=this.visibles[e].campaign.notes[this.visibles[e].noteName],r.needs.spacer(x.config)&&this.spacer.set(x);this.spacer.execute(),await d.prepareForAnimation(O);let I=new i;return I.add(O),o?(I.playLastFrame(),this.after(b,I),1):(await new u.Promise(e=>{I.play(()=>{this.after(b,I),e()},()=>{f(l.CORE.EVENTS.ANIMATING,{status:!0,animator:I})})}),2)},resolve:function(e){e&&e.callback&&u.requestAnimationFrame(()=>{e.callback("after")})},after:function(e,i){this.busy&&(this.busy=!1,f(l.CORE.EVENTS.ANIMATING,{status:!1,animator:i}));let n={opened:[],closed:[]};for(let i of t.values(e))n[i.command==v.CLOSE?"closed":"opened"].push(i);this.stopper&&u.document.activeElement.blur(),f(l.CORE.EVENTS.VISIBLE,n);for(var o,s=e.length;s--;)(o=e[s]).campaign.afterAnimation(o.noteName),this.resolve(o);u.requestAnimationFrame(()=>{this.next(p)})},add:function(e,t,i,n,o,s){var r=this.queue.length,a=t.config.campaignId;if(a in this.visibles&&this.visibles[a].noteName==n&&this.visibles[a].campaign.notes[n].visible==i)return;for(;r--&&this.queue[r].campaign!=t;);return~r?this.queue[r].command==v.CLOSE&&i==v.OPEN?(this.queue[e](y(t,i,n,o)),!0):(p&&(s=!0),s?(this.queue.splice(r,1),this.add(e,t,i,n,o)):"unshift"==e&&0===r):(this.queue[e](y(t,i,n,o)),!0)},indexOf:function(e){for(var t=this.queue.length;t--;)if(this.queue[t].campaign==e)return t;return-1},lazy:function(e,t,i,n,o){if(t.config.steps){let s=t.config.steps[n];if(s&&s.loader)return s.loader().then(()=>this[e](t,i,n,o))}},push:function(e,t,i,n){return e.notes[i]?new g.Promise(o=>{this.add("push",e,t,i,o,n)&&!this.busy?this.next().finally(()=>{o()}):o()}):this.lazy("push",e,t,i,n)},close:function(e,t,i){return new g.Promise(n=>{let o=e&&this.visibles[e.id];if(o){this.add("unshift",o.campaign,"close",o.noteName,n)?this.next(1,t,i).finally(()=>{n(e)}):n(e)}else n(e)})},now:function(e,t,i,n){let o=e.notes[i];return o?new g.Promise(async s=>{this.add("unshift",e,t,i,s,n)?this.next(1).finally(()=>{s(o)}):s(o)}):this.lazy("now",e,t,i,n)},visible:function(e){return!(!e||!this.visibles[e.id])},isNoteVisible:function(e,t){let i=e&&this.visibles[e.id];if(i)return i.noteName==t},simpleVisibles:function(){let e={};for(let t in this.visibles){let i=this.visibles[t];e[t]={campaignId:t,name:i.noteName}}return e},visibleNotes:function(){return Object.keys(this.visibles).map(function(e){var t=this.visibles[e];return t.campaign.notes[t.noteName]},this)},waitUntilAvailable:function(){return new g.Promise(e=>{let t=()=>{this.busy?g.setTimeout(t,50):e()};t()})}},n.expose(new b,"orchestrator")}),sndefine("note-anchored",["utils","note-base","animation-utils","behaviour","note-utils","core-sleeknote","constants","css","orchestrator","anchors"],function(e,t,i,n,o,s,r,a,c,l){var h=globalThis;let{sides:f,evenValue:g,fixFlexboxWidths:d,PNG2SVG:u,fixVersion2DOM:m,fixDOM:p,createLabels:v}=o;const y=r.CORE.COMMANDS,b=!s.editor;function E(e,t){return e.x>=t.x&&e.y>=t.y&&e.x+e.width<=t.x+t.width&&e.y+e.height<=t.y+t.height}function O(e){return Array.from(e.querySelectorAll('[tabindex]:not([tabindex="-1"])'))}function O(e){return[...e.querySelectorAll('[tabindex]:not([tabindex="-1"])'),...Array.from(e.querySelectorAll("*")).flatMap(e=>e.shadowRoot?O(e.shadowRoot):[])]}return class extends t{constructor(e){super(e),this.kind="AnchoredNote",this.config.current||(this.config.current=y.CLOSE),this.config.next=this.config.current,this.config.reveal=y.OPEN}async afterInsert(){if(await super.afterInsert()){if(this.production&&this.config.version<4){let{support:e}=await h.arequire("package-legacy");e.prepare(this)}return this.editor&&this.setScrolling(),"teaser"!=this.config.type&&this.config.boxNode.ownerDocument.addEventListener("keydown",e=>{if(c.isNoteVisible(this.campaign,this.config.name)){let{keyCode:t,shiftKey:i}=e;if(27==t&&c.triggerCloseAction({}),n.needs.cover(this.config)){if(9!=e.keyCode)return;let t=O(this.config.boxNode),n=t[t.length-1];if(n){let o=function(){let{activeElement:e}=h.document;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}();i&&o==t[0]&&(n.focus(),e.preventDefault()),i||o!=n||(t[0].focus(),e.preventDefault())}}}},!0),!0}}get animating(){return c.busy}setScrolling(){if(this.config.profile==r.PROFILE.MOBILE&&("calendar"==this.config.type||"socialvideo"==this.config.type))return;if("teaser"==this.config.type)return;let e="simple",t=n.isSideBar(this.config);t&&(e="container");let i=this.config.formNode;if("simple"==e){let e=i.getBoundingClientRect(),t="visualViewport"in h?h.visualViewport.height:n.fullHeightPx,o=e.height>t;if(o){let t=i.querySelector('[data-sn-type="sticker"]');t&&!E(t.getBoundingClientRect(),e)&&(o=!1);let n=i.querySelector('[data-sn-type="close"]');n&&!E(n.getBoundingClientRect(),e)&&(o=!1)}o&&a.set(this.config.boxNode,{overflowY:"auto",overflowX:"hidden"})}else if("container"==e&&this.dims){let n=this.config.boxNode.style,o=this.dims.bounds.other,s=t?0:parseInt(n.paddingTop,10)||0+parseInt(n.paddingBottom,10)||0+this.dims.move.y||0+o.top+o.bottom,r="100vh";n.maxHeight=r;let a=s?`calc(${r} - ${s}px)`:r;if(i.style.maxHeight=a,"form"==e)i.style.overflowY="auto",i.style.setProperty("pointer-events","auto","important");else if("container"==e){let e=i.querySelector(":scope > .flex-container-container");e&&(e.style.maxHeight=a,t&&(e.style.alignContent="center"),e.querySelectorAll(":scope > .flex-container.flexbox").forEach(e=>{e.style.maxHeight=a,e.style.overflowY="auto",e.style.setProperty("pointer-events","auto","important"),t&&(e.style.minHeight=a)}))}}}get insertionTarget(){return(async()=>{let t=n.animationParameters({config:this.config,dimensions:function(){return{}}},"close","open"),i=await l[e.contains(t.to.anchor,r.AL.BOTTOM_RIGHT,r.AL.BOTTOM_LEFT)?"bottom":"top"];return b?i.shadowRoot:i})()}get visible(){return!this.hidden&&this.config.next}get hidden(){return"close"==this.config.next}get sideBox(){return n.isSideBar(this.config)&&"teaser"!=this.config.type}setDOMNodeStyles(e){a.set(this.config.DOMNode,e)}applyConfig(e){super.applyConfig(e),this.reposition(!0),this.config.reveal=y.OPEN}afterAnimation(){if(super.afterAnimation(),this.hidden)a.conceal(this.config.topNode),n.needs.cover(this.config)&&this.config.DOMNode.setAttribute("aria-modal","false");else if(c.isNoteVisible(this.campaign,this.config.name)&&n.needs.cover(this.config)){this.config.DOMNode.setAttribute("aria-modal","true");let e=O(this.config.boxNode);e[0]&&e[0].focus()}}calculateDimensions(){var t={x:0,y:0};s.hasCustomProp("moveBox")&&(t=s.custom("moveBox")(this.config,t));let i=n.distanceFromEdges(this,!0),o=100==this.config.relativeWidth;f.forEach(function(n){if(i[n]>0){let s=e.contains(n,"left","right")?"x":"y";if(o&&this.config.attach!=n&&"x"==s)return;t[s]+=g(i[n])}},this);let r="auto";if(this.config.relativeWidth){let e=0;e=o?2*t.x:(~i.right?i.right:0)+(~i.left?i.left:0),r=`calc(${this.config.relativeWidth}% - ${e}px)`}let a=n.isSideBar(this.config)&&this.editor&&"teaser"!=this.config.type?"100%":"auto",c=this.getBoxBounds();this.dims={width:r,height:a,move:t,bounds:c,edge:i}}reposition(e){this.calculateDimensions(),this.setDOMNodeStyles(i.createPositionStyles(n.boxParameters(this,this.config.current),"to"))}async applyFixes(){await super.applyFixes(),d.call(this),u.call(this),m.call(this),await p.call(this),v.call(this)}async getFromTo(e){var t,i=this.config.current;switch(e){case y.CURRENT:t=this.config.current,i=y.CLOSE;break;case y.OPEN:case y.REVEAL:this.editor||this.setScrolling(),await this.onBeforeOpen(),t=y.OPEN;break;default:t=y.CLOSE}return t==i?{}:(this.config.next=t,t!==y.CLOSE&&(this.config.reveal=t),{from:i,to:t})}getCloseFunc(){if(this.campaign.config.managed)return"hideBox";if("form"==this.config.type&&this.config.teaser)return"openTeaser";if(this.customerPreview){if("teaser"==this.config.type)return"hideTeaserAndDontShowAgain"}else{if(this.preview){if("teaser"==this.config.type)return"openSleeknote";if("success"==this.config.type){let e=this.campaign.getType("teaser")[0];return e?(this.config.teaser=e.config.name,"openTeaser"):(this.config.form=this.campaign.getType("form")[0].config.name,"openSleeknote")}return"previewDummy"}if("teaser"==this.config.type)return"hideTeaserAndDontShowAgain"}return"hideBox"}outsideClick(e,t){if(!this.detectMobileButtonClick(e,t)){var i=this.config.formNode.getBoundingClientRect();if(!(e.clientX>=i.left&&e.clientX<=i.right&&e.clientY>=i.top&&e.clientY<=i.bottom)){var n=this.doc.querySelectorAll("[data-sn-type=close], .sleeknoteMobileClose")[0];n&&this.onClick(e,n)}}}openTeaser(e,t){this.campaign.teaserExist?this.event({command:y.OPEN,type:"teaser",name:this.campaign.first("teaser"),eventTarget:t}):this.hideBox(e,t)}hideBox(e,t){this.event({command:y.CLOSE,eventTarget:t})}hideTeaserAndDontShowAgain(e,t){(this.production||this.preview)&&this.event({command:y.CLOSE,eventTarget:t})}}}),sndefine("note-bar",["utils","note-anchored","behaviour","note-utils","core-sleeknote","constants","css","anchors"],function(e,t,i,n,o,s,r,a){var c=this.document;const l=!o.editor;let{qs:h,allowBackgroundClicks:f,adjustTabletSleekbar:g,flattenFlexboxOrder:d}=n;const u=s.CORE.COMMANDS;return class extends t{constructor(e){super(e),this.kind="BarNote",this.config.current||(this.config.current=u.CLOSE),this.config.next=this.config.current,this.config.reveal=this.config.toggle?u.MINIMIZE:u.OPEN}async applyFixes(){await super.applyFixes(this.doc),e.qsa('[data-sn-custom-action=""]',this.doc).forEach(e=>{e.removeAttribute("data-sn-custom-action")})}reposition(){super.reposition();let e=this.config.DOMNode.offsetWidth,t=(e-this.config.formNode.offsetWidth)/2,i=h(this.doc,".column-bg");i&&(t>0?r.set(i.parentElement,{inset:`0 ${t}px 0 -${t}px`,width:`${e}px`}):r.set(i.parentElement,{inset:"0 -50vw",width:""}))}async afterInsert(){if(await super.afterInsert())return this.editor||(g.call(this),f.call(this),r.set(this.config.boxNode,"width","100%")),!0}setScrolling(){}get insertionTarget(){return this.config.profile!=s.PROFILE.DESKTOP&&!o.custom("sleekbarNoMobileSticky")||this.config.position!=s.POS.HELLO||e.empty(this.config.placement)||o.preview||o.editor?(async()=>{let e=await a[this.config.position==s.POS.HELLO?"top":"bottom"];return l?e.shadowRoot:e})():c.body}setToggleIf(t){let i=this.toggleDOMNode();if(i){let t,n=h(this.doc,'[data-type="closebar"]');i.offsetHeight?(n&&e.removeNode(n),t=i):n&&(e.removeNode(i),t=n),t&&r.set(t,"order",e.contains(this.config.position,s.POS.HELLO)?t.parentElement.children.length:0)}d.call(this,this.doc)}applyConfig(t){super.applyConfig(t);let i=this.toggleDOMNode();if(i){let t,n=h(this.doc,'[data-type="closebar"]');i.offsetHeight?t=i:n&&(t=n),t&&r.set(t,"order",e.contains(this.config.position,s.POS.HELLO)?t.parentElement.children.length:0)}this.reposition(!0),this.config.reveal=i?u.MINIMIZE:u.OPEN}toggleDOMNode(){return this.config.toggle&&h(this.doc,this.config.toggle)}get isSleekBar(){return!0}toggleToggleButton(e){var t,i=h(this.config.boxNode,'[data-sn-custom-step="toggleForm"]');i&&(i.classList.remove("toggle-arrow-up"),i.classList.remove("toggle-arrow-down"),t=this.config.position==s.POS.HELLO?"open"==e?"toggle-arrow-up":"toggle-arrow-down":"open"==e?"toggle-arrow-down":"toggle-arrow-up",i.classList.add(t))}async getFromTo(e){var t,n=this.config.current;switch(e){case u.CURRENT:t=this.config.current,n=u.CLOSE;break;case u.MAXIMIZE:t=u.OPEN;break;case u.OPEN:case u.REVEAL:await this.onBeforeOpen(),t=u.REVEAL;break;case u.MINIMIZE:t=u.MINIMIZE;break;default:t=u.CLOSE}return t==u.REVEAL&&(t=this.config.reveal||(i.isSleekBar(this.config)?u.MINIMIZE:u.OPEN)),t==n?{}:(t!=u.MINIMIZE&&n!=u.MINIMIZE||this.toggleDOMNode()||(t==u.MINIMIZE&&(t=u.OPEN),n==u.MINIMIZE&&(n=u.CLOSE)),this.config.next=t,t!==u.CLOSE&&(this.config.reveal=t),this.toggleToggleButton(t),{from:n,to:t})}toggleForm(e,t){this[(this.config.current==u.MINIMIZE?"maximize":"minimize")+"Form"](e,t)}maximizeForm(e,t){this.event({command:u.MAXIMIZE,eventTarget:t})}minimizeForm(e,t){this.event({command:u.MINIMIZE,eventTarget:t})}}}),sndefine("campaign-anchored",["browser","utils","constants","core-sleeknote","campaign-base","orchestrator","note-anchored","note-bar","font-loader2","event-emitter","site-data","global","core-api","css","anchors"],function(e,t,i,n,o,s,r,a,c,l,h,f,g,d,u){var m=this,p=this.document;const v=i.CORE.COMMANDS;return class y extends o{constructor({config:e}){super({config:e}),this.kind="AnchoredCampaign"}handleEvent(e){if(super.handleEvent(e),e.data.campaignId!=this.id)return;let{creator:t,command:n,name:o,ffwd:r,trigger:a}=e.data;switch(t==i.CORE.CREATOR.USER&&(this.config.smartIndex=0),n){case v.CLOSE:if("teaser"==e.data.origin.config.type&&this.tameTeaser(),"queue"==a)break;e.data.result=s.waitUntilAvailable().then(()=>s.close(this,r,t==i.CORE.CREATOR.USER));break;case v.QUEUE:if(t==i.CORE.CREATOR.API){if(this.config.campaignId in s.visibles&&"timer"!=e.data.trigger)break}e.data.result=s.push(this,v.OPEN,o);break;case v.OPEN:case v.REVEAL:case v.MAXIMIZE:case v.MINIMIZE:if("queue"==a)break;this.tameTriggers(),e.data.result=s.waitUntilAvailable().then(()=>s.now(this,n,o))}}static async create(e,t){let i=new y(e);if(await i.load(t)||n.editor){var o=i.getType("teaser");if(o.length){i.config.hidden&&!i.config.managed||(i.teaserExist=!0);var s=o[0];s.config.showAfterForm&&(i.teaserExist=!0);var r=s.config.teaserDelay;r&&r>0&&!n.editor&&await new f.Promise(e=>{f.setTimeout(e,1e3*r)})}return i}console.log(`Sleeknote campaign ${i.id} failed to preload`)}async destroy(e,i,n){!s.visible(this)||i?(s.close(this,!0,n),super.destroy(e)):(await s.close(this,!1,n),super.destroy(e)),this.onClickListener&&t.listener(p,"remove",this.onClickListener)("click")}get busy(){return s.busy}async load(e){let{template:o,fontsToLoad:s}=await this.html(e);if(o){for(let[e,l]of t.entries(this.config.steps))if(this.config.steps[e].guid=l.guid=this.guid,l.loader=async()=>{l.loader=null;let n={config:l,campaign:this,html:"content"in o?t.qs(l.id,o.content):o[e],name:e,profileStr:this.profileStr,isTouch:this.isTouch},h=t.contains(this.config.position,i.POS.HELLO,i.POS.HELLO2)?a:r,f=new h(n);try{await f.insert(n),h==r&&u.reorderAnchors(),await c(s,f.config.boxNode),d.conceal(f.config.topNode),this.notes[e]=f}catch(e){return console.error(e),!1}},(String(l.name).toLowerCase().includes("teaser")||String(l.name).toLowerCase().includes("form")||String(l.name).toLowerCase().includes("calendar")||"--1"==String(l.name).slice(-3)||n.editor&&l.isActive)&&0==await l.loader())return!1;return!0}}aftersubmit(e,t){return super.aftersubmit(e,t),this.API({command:e,noteName:t})}getFormLike(){return this.getType("form")[0]||this.getType("calendar")[0]}get isSleekBar(){var e=this.getFormLike();return e&&e.isSleekBar}ifTrigger(t){switch(t){case"scroll":if(this.config.scroll&&e.scroll.pct()>=this.config.scroll)return this.tameTriggers();break;case"exit":if(this.config.exit)return this.tameTriggers();break;case"timer":if(this.config.wait)return this.tameTriggers()}}launchTriggers(e,o){this.config.wait>0?this.timer=f.setTimeout(function(){this.ifTrigger("timer")&&e("timer",this)}.bind(this),this.config.wait):o||this.config.hidden||this.config.exit||this.config.scroll||this.config.onClickIntent||e("timer",this),this.config.onClick&&!this.onClickListener&&(this.onClickListener=function(e){this.config.onClick&&t.querySelectorClosest(e.target,this.config.onClick.selector)&&g("launch",this.config.campaignId,this.config.onClick.triggerOnce)}.bind(this),t.listener(p,"add",this.onClickListener)("click")),this.triggerOnSiteDataIf();let s=this.getFormLike();(s&&t.contains(s.config.position,i.POS.HELLO,i.POS.HELLO2)||n.preview&&!this.config.wait)&&e("notification",this)}async triggerOnSiteDataIf(){if(this.config.siteData){let e=await m.arequire("float-match");for(let i of this.config.siteData.values()){e(t.findPropValue(h.getSession(this.config.NS),i.property),i.type,i.value)&&g("launch",this.config.campaignId,!1)}}if(this.config.shopify){let e=await m.arequire("float-match");for(let n of this.config.shopify.values()){let o=t.translateShopifyKeysToSiteDataProperties(n.property,i.CONDITIONS.SHOPIFY_CONDITION_TARGETS);e(t.findPropValue(h.getSession(this.config.NS),o),n.type,n.value)&&g("launch",this.config.campaignId,!1)}}}tameTeaser(){let e=this.getType("teaser")[0];e&&!e.config.showAfterForm&&(this.teaserExist=!1),this.config.managed&&(this.teaserExist=!1),this.tameTriggers()}tameTriggers(){return this.timer&&f.clearTimeout(this.timer),this.config.hidden=!0,this.config.wait=0,this.config.exit=!1,this.config.scroll=0,!0}API({command:e,noteName:n,keep:o,ffwd:r,trigger:a}){let c=super.API.apply(this,arguments);if(c.handled)return c;const h=i.CORE.API;function g(e=!0){return{result:e,handled:!0}}switch(e){case h.STATUS:let o={};for(let[e,i]of t.entries(s.visibles))o[e]={campaignId:e,name:i.noteName};return g(o);case h.CLOSE:let c,d=s.visibles[this.config.campaignId];return c=d?l(v.CLOSE,{name:d.noteName,creator:i.CORE.CREATOR.API,campaignId:this.config.campaignId,origin:this.notes[d.noteName],trigger:"api",ffwd:r}):f.Promise.resolve(),g(c);case h.QUEUE:case h.OPEN:case h.MAXIMIZE:case h.MINIMIZE:if(t.contains(e,h.MAXIMIZE,h.MINIMIZE)&&!n){let e=s.visibles[this.config.campaignId];e&&(n=e.noteName)}if(n)return e==h.QUEUE&&(e=v.QUEUE),e==h.OPEN&&(e=v.OPEN),e==h.MAXIMIZE&&(e=v.MAXIMIZE),e==h.MINIMIZE&&(e=v.MINIMIZE),g(l(e,{name:n,creator:i.CORE.CREATOR.API,campaignId:this.config.campaignId,origin:this.notes[n],trigger:a||"api"}));break;case h.VISIBLE:let u,m=s.visible(this),p=this.getFormLike().config.position;return m&&(u=s.visibles[this.id].noteName),g({note:u,show:m,position:p})}return{handled:!1}}}}),sndefine("package-anchored",["campaign-anchored","orchestrator"],function(e,t){return{AnchoredCampaign:e,orchestrator:t}});